# ğŸŒŸ Trustpilot Automation - System Workflow

## Architecture Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     TRUSTPILOT AUTOMATION                       â”‚
â”‚                    Advancia Pay Ledger                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                      EXTERNAL SERVICE                          â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â•‘
â•‘  â”‚         Trustpilot API                                   â”‚  â•‘
â•‘  â”‚  https://api.trustpilot.com/v1/business-units          â”‚  â•‘
â•‘  â”‚                                                          â”‚  â•‘
â•‘  â”‚  â€¢ Business Reviews                                     â”‚  â•‘
â•‘  â”‚  â€¢ Star Ratings (1-5)                                   â”‚  â•‘
â•‘  â”‚  â€¢ Customer Names & Comments                            â”‚  â•‘
â•‘  â”‚  â€¢ Verified Purchase Status                             â”‚  â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â•‘
â•‘                       â”‚                                        â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â–¼â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                        â”‚
                        â”‚ HTTPS Request
                        â”‚ API Key Auth
                        â”‚ Every 6 hours
                        â”‚
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â–¼â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    BACKEND SERVICES                            â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                 â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â•‘
â•‘  â”‚  RPA Scheduler (scheduler.ts)                            â”‚ â•‘
â•‘  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚ â•‘
â•‘  â”‚  â”‚  Cron Job: "0 */6 * * *"                         â”‚    â”‚ â•‘
â•‘  â”‚  â”‚  Triggers: trustpilotCollector.syncReviews()     â”‚    â”‚ â•‘
â•‘  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â•‘
â•‘                          â”‚                                     â•‘
â•‘                          â–¼                                     â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â•‘
â•‘  â”‚  Trustpilot Collector (trustpilotCollector.ts)          â”‚ â•‘
â•‘  â”‚                                                           â”‚ â•‘
â•‘  â”‚  1ï¸âƒ£  Fetch latest 50 reviews from Trustpilot API        â”‚ â•‘
â•‘  â”‚  2ï¸âƒ£  Filter: Only 5-star reviews (best positive)       â”‚ â•‘
â•‘  â”‚  3ï¸âƒ£  Check for duplicates (by trustpilotId)             â”‚ â•‘
â•‘  â”‚  4ï¸âƒ£  Insert new / Update existing reviews               â”‚ â•‘
â•‘  â”‚  5ï¸âƒ£  Auto-publish 5-star reviews only                   â”‚ â•‘
â•‘  â”‚  6ï¸âƒ£  Log activity to audit trail                        â”‚ â•‘
â•‘  â”‚  7ï¸âƒ£  Return sync statistics                             â”‚ â•‘
â•‘  â”‚                                                           â”‚ â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â•‘
â•‘                          â”‚                                     â•‘
â•‘                          â–¼                                     â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â•‘
â•‘  â”‚  PostgreSQL Database                                      â”‚ â•‘
â•‘  â”‚                                                           â”‚ â•‘
â•‘  â”‚  Table: trustpilot_reviews                               â”‚ â•‘
â•‘  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚ â•‘
â•‘  â”‚  â”‚ id               â”‚ UUID                     â”‚         â”‚ â•‘
â•‘  â”‚  â”‚ trustpilotId     â”‚ String (unique)          â”‚         â”‚ â•‘
â•‘  â”‚  â”‚ stars            â”‚ Int (1-5)                â”‚         â”‚ â•‘
â•‘  â”‚  â”‚ title            â”‚ String?                  â”‚         â”‚ â•‘
â•‘  â”‚  â”‚ text             â”‚ Text                     â”‚         â”‚ â•‘
â•‘  â”‚  â”‚ reviewerName     â”‚ String                   â”‚         â”‚ â•‘
â•‘  â”‚  â”‚ isVerified       â”‚ Boolean                  â”‚         â”‚ â•‘
â•‘  â”‚  â”‚ isPublished      â”‚ Boolean                  â”‚         â”‚ â•‘
â•‘  â”‚  â”‚ reviewDate       â”‚ DateTime                 â”‚         â”‚ â•‘
â•‘  â”‚  â”‚ createdAt        â”‚ DateTime                 â”‚         â”‚ â•‘
â•‘  â”‚  â”‚ updatedAt        â”‚ DateTime                 â”‚         â”‚ â•‘
â•‘  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚ â•‘
â•‘  â”‚                                                           â”‚ â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â•‘
â•‘                          â”‚                                     â•‘
â•‘                          â–¼                                     â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â•‘
â•‘  â”‚  API Routes (/api/trustpilot/*)                          â”‚ â•‘
â•‘  â”‚                                                           â”‚ â•‘
â•‘  â”‚  PUBLIC:                                                 â”‚ â•‘
â•‘  â”‚  â€¢ GET  /reviews     - Published reviews (paginated)     â”‚ â•‘
â•‘  â”‚  â€¢ GET  /stats       - Avg rating, counts                â”‚ â•‘
â•‘  â”‚                                                           â”‚ â•‘
â•‘  â”‚  ADMIN ONLY:                                             â”‚ â•‘
â•‘  â”‚  â€¢ POST   /sync           - Trigger manual sync          â”‚ â•‘
â•‘  â”‚  â€¢ GET    /admin/all      - All reviews (unpublished)    â”‚ â•‘
â•‘  â”‚  â€¢ PATCH  /admin/:id/publish - Publish/unpublish         â”‚ â•‘
â•‘  â”‚  â€¢ DELETE /admin/:id      - Delete review                â”‚ â•‘
â•‘  â”‚                                                           â”‚ â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â•‘
â•‘                          â”‚                                     â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â–¼â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                           â”‚
                           â”‚ JSON Response
                           â”‚ CORS Enabled
                           â”‚
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â–¼â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    FRONTEND COMPONENTS                          â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                 â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â•‘
â•‘  â”‚  TrustpilotReviews.tsx                                   â”‚ â•‘
â•‘  â”‚                                                           â”‚ â•‘
â•‘  â”‚  1ï¸âƒ£  useEffect: Fetch reviews from API                  â”‚ â•‘
â•‘  â”‚  2ï¸âƒ£  Fetch statistics (avg rating, counts)              â”‚ â•‘
â•‘  â”‚  3ï¸âƒ£  Display in responsive grid                         â”‚ â•‘
â•‘  â”‚  4ï¸âƒ£  Show star ratings & verified badges                â”‚ â•‘
â•‘  â”‚  5ï¸âƒ£  Link to full Trustpilot page                       â”‚ â•‘
â•‘  â”‚                                                           â”‚ â•‘
â•‘  â”‚  Props:                                                  â”‚ â•‘
â•‘  â”‚  â€¢ limit: number (default 6)                            â”‚ â•‘
â•‘  â”‚  â€¢ showTitle: boolean (default true)                    â”‚ â•‘
â•‘  â”‚                                                           â”‚ â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â•‘
â•‘                          â”‚                                     â•‘
â•‘                          â–¼                                     â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â•‘
â•‘  â”‚  User Interface                                          â”‚ â•‘
â•‘  â”‚                                                           â”‚ â•‘
â•‘  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚ â•‘
â•‘  â”‚  â”‚ â­â­â­â­â­   â”‚  â”‚ â­â­â­â­â­   â”‚  â”‚ â­â­â­â­â˜†   â”‚         â”‚ â•‘
â•‘  â”‚  â”‚            â”‚  â”‚            â”‚  â”‚            â”‚         â”‚ â•‘
â•‘  â”‚  â”‚ Great!     â”‚  â”‚ Excellent! â”‚  â”‚ Good       â”‚         â”‚ â•‘
â•‘  â”‚  â”‚ - John D.  â”‚  â”‚ - Jane S.  â”‚  â”‚ - Bob M.   â”‚         â”‚ â•‘
â•‘  â”‚  â”‚ âœ… Verifiedâ”‚  â”‚ âœ… Verifiedâ”‚  â”‚            â”‚         â”‚ â•‘
â•‘  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚ â•‘
â•‘  â”‚                                                           â”‚ â•‘
â•‘  â”‚  Average: 4.8 â­ â€¢ 125 reviews                           â”‚ â•‘
â•‘  â”‚                                                           â”‚ â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â•‘
â•‘                                                                 â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

```

## Data Flow Sequence

```
â”Œâ”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Cron â”‚â”€â”€â”€â”€â–¶â”‚ Schedulerâ”‚â”€â”€â”€â”€â–¶â”‚ Collector  â”‚â”€â”€â”€â”€â–¶â”‚ Database â”‚â”€â”€â”€â”€â–¶â”‚   API   â”‚
â”‚ Job  â”‚     â”‚          â”‚     â”‚            â”‚     â”‚          â”‚     â”‚ Routes  â”‚
â””â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â”‚              â”‚                  â”‚                  â”‚               â”‚
   â”‚ Every 6h     â”‚ Call sync()      â”‚ Fetch from       â”‚ Store        â”‚ Serve
   â”‚              â”‚                  â”‚ Trustpilot       â”‚ reviews      â”‚ JSON
   â”‚              â”‚                  â”‚                  â”‚               â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                                         â”‚
                                                                         â–¼
                                                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                              â”‚  Next.js Client â”‚
                                                              â”‚  (React)        â”‚
                                                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Sync Process Detail

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SYNC PROCESS (Every 6 hours)                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. ğŸ”„ Trigger
   â””â”€â–¶ Cron job fires at scheduled time
   â””â”€â–¶ Or admin manually triggers via POST /api/trustpilot/sync

2. ğŸ“¡ Fetch from Trustpilot
   â””â”€â–¶ GET https://api.trustpilot.com/v1/business-units/{id}/reviews
   â””â”€â–¶ Query params: { page: 1, perPage: 50, stars: "5" }
   â””â”€â–¶ Auth: apikey header

3. âš—ï¸ Filter & Process
   â””â”€â–¶ Only 5-star reviews (best positive feedback)
   â””â”€â–¶ Extract: id, stars, title, text, reviewer, verified status
   â””â”€â–¶ Convert dates to ISO format

4. ğŸ” Check Duplicates
   â””â”€â–¶ For each review:
       â””â”€â–¶ Query DB by trustpilotId
       â””â”€â–¶ If exists: UPDATE
       â””â”€â–¶ If new: INSERT

5. âœ… Auto-Publish
   â””â”€â–¶ Set isPublished = true for 5-star reviews only
   â””â”€â–¶ Keep unpublished if < 4 stars (for manual review)

6. ğŸ“ Log Activity
   â””â”€â–¶ Create audit log entry
   â””â”€â–¶ Record: synced count, error count, timestamp
   â””â”€â–¶ Store in auditLog table

7. ğŸ“Š Return Stats
   â””â”€â–¶ Calculate: total, published, avg rating, distribution
   â””â”€â–¶ Return to caller (for monitoring)

8. âœ¨ Complete
   â””â”€â–¶ Log success message
   â””â”€â–¶ Reviews now available via API
   â””â”€â–¶ Frontend can display immediately
```

## Admin Management Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ADMIN REVIEW MANAGEMENT                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. View All Reviews
   GET /api/trustpilot/admin/all
   â””â”€â–¶ Returns all reviews (published + unpublished)
   â””â”€â–¶ Requires: Admin JWT token

2. Publish/Unpublish Review
   PATCH /api/trustpilot/admin/:id/publish
   Body: { "isPublished": true/false }
   â””â”€â–¶ Toggle visibility on frontend
   â””â”€â–¶ Useful for moderation

3. Delete Review
   DELETE /api/trustpilot/admin/:id
   â””â”€â–¶ Permanently remove from database
   â””â”€â–¶ Use cautiously (consider unpublish instead)

4. Manual Sync
   POST /api/trustpilot/sync
   â””â”€â–¶ Trigger sync outside of schedule
   â””â”€â–¶ Useful for testing or urgent updates
   â””â”€â–¶ Returns sync results immediately
```

## Security Model

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SECURITY LAYERS                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. ğŸ” API Key Protection
   â””â”€â–¶ Trustpilot API key stored in .env
   â””â”€â–¶ Never exposed to frontend
   â””â”€â–¶ Server-side only

2. ğŸ”’ JWT Authentication
   â””â”€â–¶ Admin endpoints require valid JWT
   â””â”€â–¶ authenticateToken + requireAdmin middleware
   â””â”€â–¶ Public endpoints: /reviews, /stats (no auth)

3. ğŸ›¡ï¸ Rate Limiting
   â””â”€â–¶ Express rate limiter on all /api/* routes
   â””â”€â–¶ Prevents abuse of public endpoints

4. âœ… Input Validation
   â””â”€â–¶ Zod schemas for request validation
   â””â”€â–¶ Sanitize inputs before DB queries

5. ğŸ“ Audit Trail
   â””â”€â–¶ All admin actions logged
   â””â”€â–¶ Sync activities recorded
   â””â”€â–¶ Timestamp + user tracking

6. ğŸ” CORS Protection
   â””â”€â–¶ Only allowed origins can access API
   â””â”€â–¶ Configured in config.ts
```

## Error Handling

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ERROR HANDLING & RECOVERY                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. API Errors
   â””â”€â–¶ Trustpilot API down
       â””â”€â–¶ Log error + continue
       â””â”€â–¶ Return { synced: 0, errors: 1 }
       â””â”€â–¶ Next sync will retry

2. Database Errors
   â””â”€â–¶ Duplicate key violation
       â””â”€â–¶ Skip and continue
   â””â”€â–¶ Connection timeout
       â””â”€â–¶ Log + retry next cycle

3. Invalid Data
   â””â”€â–¶ Missing required fields
       â””â”€â–¶ Skip review + log warning
       â””â”€â–¶ Continue with valid reviews

4. Authentication Errors
   â””â”€â–¶ Invalid API key
       â””â”€â–¶ Log error immediately
       â””â”€â–¶ Alert admin (email/notification)

5. Rate Limiting
   â””â”€â–¶ Trustpilot rate limit hit
       â””â”€â–¶ Backoff + retry
       â””â”€â–¶ Log rate limit encounter

6. Frontend Errors
   â””â”€â–¶ API unavailable
       â””â”€â–¶ Show cached reviews (if available)
       â””â”€â–¶ Display loading state
       â””â”€â–¶ Graceful degradation
```

---

**Created**: November 18, 2025  
**Status**: Production Ready âœ…  
**Version**: 1.0.0
